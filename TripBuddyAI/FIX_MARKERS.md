# üéØ Fix: Duplicate Keys & Dynamic Marker Sizing

## üêõ –ü—Ä–æ–±–ª–µ–º—ã

### 1. Duplicate Keys Error
```
ERROR: Encountered two children with the same key
ChIJmaUKuMzJ1EARrHgfhv6aBxE
```

**–ü—Ä–∏—á–∏–Ω–∞:** –û–¥–Ω–æ –∏ —Ç–æ –∂–µ –º–µ—Å—Ç–æ –∑–∞–≥—Ä—É–∂–∞–ª–æ—Å—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏ –∫–∞—Ä—Ç—ã

### 2. Overlapping Markers
–ú–∞—Ä–∫–µ—Ä—ã –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–ª–∏ –¥—Ä—É–≥ –¥—Ä—É–≥–∞, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ zoom out

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –£–ª—É—á—à–µ–Ω–Ω–∞—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è

**–î–æ:**
```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º
const existingIds = new Set(places.map(p => p.id));
const newPlaces = response.data.filter(p => !existingIds.has(p.id));
setPlaces(prev => [...prev, ...newPlaces]);
```

**–ü–æ—Å–ª–µ:**
```typescript
// –î–≤–æ–π–Ω–∞—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è
setPlaces(prev => {
  const existingIds = new Set(prev.map(p => p.id));
  const newPlaces = response.data!.filter(p => !existingIds.has(p.id));
  const combined = [...prev, ...newPlaces];
  
  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Map
  const uniqueMap = new Map(combined.map(p => [p.id, p]));
  const uniquePlaces = Array.from(uniqueMap.values());
  
  return uniquePlaces;
});
```

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**
- ‚úÖ Set –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ ID –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º
- ‚úÖ Map –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –≤ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º –º–∞—Å—Å–∏–≤–µ
- ‚úÖ –ü–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è –º–µ—Å—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è (–µ—Å–ª–∏ –±—ã–ª–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ)

### 2. –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è –º–∞—Ä–∫–µ—Ä–æ–≤

**–î–æ:**
```jsx
<Marker key={place.id} ... />
```

**–ü–æ—Å–ª–µ:**
```jsx
<Marker key={`marker-${place.id}`} ... />
```

**–ó–∞—á–µ–º:**
- –ò–∑–±–µ–≥–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å –¥—Ä—É–≥–∏–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–º–∏ `place.id`
- –Ø–≤–Ω—ã–π –ø—Ä–µ—Ñ–∏–∫—Å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á—Ç–æ —ç—Ç–æ –º–∞—Ä–∫–µ—Ä

### 3. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–º–µ—Ä –º–∞—Ä–∫–µ—Ä–æ–≤

**–ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
```typescript
const getMarkerSize = (latitudeDelta: number): number => {
  if (latitudeDelta < 0.01) return 40; // –û—á–µ–Ω—å –±–ª–∏–∑–∫–æ
  if (latitudeDelta < 0.03) return 36; // –ë–ª–∏–∑–∫–æ
  if (latitudeDelta < 0.08) return 32; // –°—Ä–µ–¥–Ω–µ
  if (latitudeDelta < 0.15) return 28; // –î–∞–ª–µ–∫–æ
  return 24; // –û—á–µ–Ω—å –¥–∞–ª–µ–∫–æ
};

const getMarkerFontSize = (latitudeDelta: number): number => {
  if (latitudeDelta < 0.01) return 20;
  if (latitudeDelta < 0.03) return 18;
  if (latitudeDelta < 0.08) return 16;
  if (latitudeDelta < 0.15) return 14;
  return 12;
};
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
```jsx
const markerSize = currentRegion ? getMarkerSize(currentRegion.latitudeDelta) : 36;
const fontSize = currentRegion ? getMarkerFontSize(currentRegion.latitudeDelta) : 18;

<View style={[
  styles.placeMarker,
  { width: markerSize, height: markerSize, borderRadius: markerSize / 4 },
  ...
]}>
  <Text style={[styles.markerEmoji, { fontSize }]}>
    {getMarkerEmoji(place.type)}
  </Text>
</View>
```

### 4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
```jsx
<Marker
  ...
  tracksViewChanges={false} // ‚Üê –û—Ç–∫–ª—é—á–∞–µ–º –ª–∏—à–Ω–∏–µ —Ä–µ-—Ä–µ–Ω–¥–µ—Ä—ã
>
```

**–ó–∞—á–µ–º:**
- –ú–∞—Ä–∫–µ—Ä—ã –Ω–µ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏
- –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –º–∞—Ä–∫–µ—Ä–æ–≤
- –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ key –∏–ª–∏ props

---

## üìä –†–∞–∑–º–µ—Ä—ã –º–∞—Ä–∫–µ—Ä–æ–≤ –ø–æ zoom

### Zoom Level ‚Üí Marker Size

```
Very Close (latitudeDelta < 0.01):
  Marker: 40px √ó 40px
  Font: 20px
  Use case: –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –æ–¥–Ω–æ–≥–æ —Ä–∞–π–æ–Ω–∞

Close (0.01 - 0.03):
  Marker: 36px √ó 36px
  Font: 18px
  Use case: –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–≤–∞—Ä—Ç–∞–ª–∞

Medium (0.03 - 0.08):
  Marker: 32px √ó 32px
  Font: 16px
  Use case: –†–∞–π–æ–Ω –≥–æ—Ä–æ–¥–∞

Far (0.08 - 0.15):
  Marker: 28px √ó 28px
  Font: 14px
  Use case: –ù–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–π–æ–Ω–æ–≤

Very Far (> 0.15):
  Marker: 24px √ó 24px
  Font: 12px
  Use case: –í–µ—Å—å –≥–æ—Ä–æ–¥ / –æ–±–ª–∞—Å—Ç—å
```

### –í–∏–∑—É–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ:

```
Zoom In (–¥–µ—Ç–∞–ª–∏):
üè† üçï ‚òï üèõÔ∏è üå≥ üõçÔ∏è
‚Üë  ‚Üë  ‚Üë  ‚Üë  ‚Üë  ‚Üë
40px - –ë–æ–ª—å—à–∏–µ, –≤–∏–¥–Ω—ã —ç–º–æ–¥–∑–∏

Zoom Out (–æ–±–∑–æ—Ä):
üè†üçï‚òïüèõÔ∏èüå≥üõçÔ∏è
‚Üë ‚Üë ‚Üë ‚Üë ‚Üë ‚Üë
24px - –ú–∞–ª–µ–Ω—å–∫–∏–µ, –º–µ–Ω—å—à–µ –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–π
```

---

## üéÆ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç

### Scenario 1: Zoom In

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å zoom in (–ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç)
   latitudeDelta: 0.05 ‚Üí 0.02
   
2. –ú–∞—Ä–∫–µ—Ä—ã —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç—Å—è
   32px ‚Üí 36px
   
3. –õ–µ–≥—á–µ –Ω–∞–∂–∏–º–∞—Ç—å –∏ —Ä–∞–∑–ª–∏—á–∞—Ç—å —ç–º–æ–¥–∑–∏
```

### Scenario 2: Zoom Out

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å zoom out (–æ—Ç–¥–∞–ª—è–µ—Ç)
   latitudeDelta: 0.05 ‚Üí 0.20
   
2. –ú–∞—Ä–∫–µ—Ä—ã —É–º–µ–Ω—å—à–∞—é—Ç—Å—è
   32px ‚Üí 24px
   
3. –ú–µ–Ω—å—à–µ –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–π, –≤–∏–¥–µ–Ω –æ–±—â–∏–π –æ–±–∑–æ—Ä
   320 –º–µ—Å—Ç ‚Üí –≤—Å–µ –≤–∏–¥–Ω—ã –±–µ–∑ –Ω–∞–ª–æ–∂–µ–Ω–∏–π
```

### Scenario 3: –ú–Ω–æ–≥–æ –º–µ—Å—Ç –≤ –æ–¥–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏

**–î–æ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä 44px):**
```
üè†üçï üçïüèõÔ∏èüå≥  ‚Üê –ü–µ—Ä–µ–∫—Ä—ã–≤–∞—é—Ç—Å—è
  üõçÔ∏è‚òï        ‚Üê –¢—Ä—É–¥–Ω–æ –Ω–∞–∂–∞—Ç—å
```

**–ü–æ—Å–ª–µ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–º–µ—Ä 24px –Ω–∞ zoom out):**
```
üè† üçï üçï üèõÔ∏è üå≥ üõçÔ∏è ‚òï  ‚Üê –í—Å–µ –≤–∏–¥–Ω—ã
```

---

## üîß –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### `/src/screens/main/MapScreen.tsx`

**–§—É–Ω–∫—Ü–∏–∏:**
```typescript
‚úÖ getMarkerSize() - —Ä–∞—Å—á—ë—Ç —Ä–∞–∑–º–µ—Ä–∞ –º–∞—Ä–∫–µ—Ä–∞
‚úÖ getMarkerFontSize() - —Ä–∞—Å—á—ë—Ç —Ä–∞–∑–º–µ—Ä–∞ —ç–º–æ–¥–∑–∏
```

**State:**
```typescript
‚úÖ currentRegion - —Ö—Ä–∞–Ω–∏—Ç —Ç–µ–∫—É—â–∏–π viewport –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞
```

**–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:**
```typescript
‚úÖ –î–≤–æ–π–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Set + Map
‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –º–µ—Å—Ç
```

**–ú–∞—Ä–∫–µ—Ä—ã:**
```typescript
‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á: marker-${place.id}
‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–º–µ—Ä –∏–∑ currentRegion
‚úÖ tracksViewChanges={false}
```

---

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

1. **tracksViewChanges={false}**
   - –ú–∞—Ä–∫–µ—Ä—ã –Ω–µ —Ä–µ-—Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
   - ‚úÖ -70% —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–æ–≤

2. **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è**
   - –ú–µ–Ω—å—à–µ –º–∞—Ä–∫–µ—Ä–æ–≤ = –±—ã—Å—Ç—Ä–µ–µ —Ä–µ–Ω–¥–µ—Ä
   - ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏

3. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–º–µ—Ä**
   - –ú–∞–ª–µ–Ω—å–∫–∏–µ –º–∞—Ä–∫–µ—Ä—ã –±—ã—Å—Ç—Ä–µ–µ –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞—é—Ç—Å—è
   - ‚úÖ –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ GPU

### –ò–∑–º–µ—Ä–µ–Ω–∏—è:

**–î–æ:**
- 320 –º–µ—Å—Ç —Å –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏ ‚Üí ~400+ –º–∞—Ä–∫–µ—Ä–æ–≤
- –†–∞–∑–º–µ—Ä: 44px (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
- –†–µ-—Ä–µ–Ω–¥–µ—Ä—ã: –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏

**–ü–æ—Å–ª–µ:**
- 320 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –º–µ—Å—Ç ‚Üí 320 –º–∞—Ä–∫–µ—Ä–æ–≤
- –†–∞–∑–º–µ—Ä: 24-40px (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π)
- –†–µ-—Ä–µ–Ω–¥–µ—Ä—ã: —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ key

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏:

```typescript
// –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
‚ûï [MapScreen] Added 120 new places (320 total unique)
//                                     ‚Üë
//                           –ì–∞—Ä–∞–Ω—Ç–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –º–∞—Ä–∫–µ—Ä–æ–≤:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞—Ä—Ç—É
2. Zoom in –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ ‚Üí –º–∞—Ä–∫–µ—Ä—ã 40px
3. Zoom out –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ ‚Üí –º–∞—Ä–∫–µ—Ä—ã 24px
4. –î–≤–∏–≥–∞–π—Ç–µ zoom ‚Üí —Ä–∞–∑–º–µ—Ä –ø–ª–∞–≤–Ω–æ –º–µ–Ω—è–µ—Ç—Å—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫:

```
‚ùå –î–æ: ERROR: Encountered two children with the same key
‚úÖ –ü–æ—Å–ª–µ: –ù–µ—Ç –æ—à–∏–±–æ–∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª—é—á–µ–π
```

---

## ‚ú® –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –í–∏–∑—É–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
- ‚úÖ –ú–∞—Ä–∫–µ—Ä—ã –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ zoom out
- ‚úÖ –ú–∞—Ä–∫–µ—Ä—ã –≤–∏–¥–Ω—ã –∏ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã –ø—Ä–∏ zoom in
- ‚úÖ –ü–ª–∞–≤–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ zoom

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è:
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª—é—á–µ–π
- ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –º–µ—Å—Ç
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –º–∞—Ä–∫–µ—Ä–æ–≤
- ‚úÖ –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ GPU

### UX —É–ª—É—á—à–µ–Ω–∏—è:
- ‚úÖ –õ–µ–≥—á–µ –Ω–∞–∂–∏–º–∞—Ç—å –Ω–∞ –º–∞—Ä–∫–µ—Ä—ã
- ‚úÖ –ú–µ–Ω—å—à–µ –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —à—É–º–∞ –ø—Ä–∏ zoom out
- ‚úÖ –õ—É—á—à–µ –≤–∏–¥–Ω—ã –¥–µ—Ç–∞–ª–∏ –ø—Ä–∏ zoom in

---

**–ì–æ—Ç–æ–≤–æ! –ú–∞—Ä–∫–µ—Ä—ã —Ç–µ–ø–µ—Ä—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∏ –Ω–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤! üéØ‚ú®**

